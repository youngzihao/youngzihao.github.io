<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ARKit by Tutorials Section Ⅲ 野生笔记 · Autobiography</title><meta name="description" content="ARKit by Tutorials Section Ⅲ 野生笔记 - null"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Autobiography"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.svg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/youngzihao" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ARKit by Tutorials Section Ⅲ 野生笔记</h1><div class="post-info">Oct 5, 2018</div><div class="post-content"><h1 id="Chapter-10-Detecting-Placeholders"><a href="#Chapter-10-Detecting-Placeholders" class="headerlink" title="Chapter 10: Detecting Placeholders"></a>Chapter 10: Detecting Placeholders</h1><h2 id="Detecting-a-rectangle"><a href="#Detecting-a-rectangle" class="headerlink" title="Detecting a rectangle"></a>Detecting a rectangle</h2><ul>
<li>Vision Framework is an image analysis and computer vision framework to identify and classify real world objects.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import Frame</span><br><span class="line"></span><br><span class="line">// 1</span><br><span class="line">guard let currentFrame = sceneView.session.currentFrame else &#123;</span><br><span class="line">  return </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 2</span><br><span class="line">DispatchQueue.global(qos: .background).async &#123;</span><br><span class="line">  // 3</span><br><span class="line">  do &#123;</span><br><span class="line">    // 4</span><br><span class="line">    let request = </span><br><span class="line">      VNDetectRectanglesRequest &#123;(request, error) in</span><br><span class="line">                                 </span><br><span class="line">      // Access the first result in the array,</span><br><span class="line">      // after converting to an array</span><br><span class="line">      // of VNRectangleObservation</span><br><span class="line">      // 5</span><br><span class="line">      guard</span><br><span class="line">        let results = request.results?</span><br><span class="line">          .compactMap(&#123; $0 as? VNRectangleObservation &#125;),</span><br><span class="line">        // 6                                 </span><br><span class="line">        let result = results.first else &#123;</span><br><span class="line">          print (&quot;[Vision] VNRequest produced no result&quot;)</span><br><span class="line">          return</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch(let error) &#123;</span><br><span class="line">    print(</span><br><span class="line">      &quot;An error occurred during rectangle detection: \(error)&quot;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>ARSession has a currentFrame property which is an instance of ARFrame. A frame is a single capture of the video feed. ARKit analyzes and combines this with the device’s motion sensing to perform its magic. Along with other data, it contains the image captured by the camera. Since you need the frame, you have to guard against a nil frame, in which case you skip processing and simply return early.</li>
<li>Image processing can be CPU intensive — and you don’t want to subtract precious cycles from the main thread! Instead, use a background thread.</li>
<li>The do/catch block will be needed soon.</li>
<li>You create a rectangle detection request which takes a closure as the only parameter. The closure is invoked when the image analysis is completed, providing the VNDetectRectanglesRequest instance just created and an optional error. The results can be accessed as a property on the request parameter.</li>
<li>The results property will be an array of VNRectangleObservation instances, one for each detected rectangle. Here you’re converting from [Any] to [VNRectangleObservation] by using compactMap(). You’re then storing the resulting array into the results variable.</li>
<li>If the request doesn’t produce any results, you can exit early because there’s nothing else to do. Otherwise, if the results array contains at least one detected rectangle, you pick the first one.</li>
<li>request will return at most one value because the maximumObservations property of VNDetectRectanglesRequest defaults to 1. But it should be the one with the highest confidence level, assuming that you’re pointing the camera toward the rectangle you want to detect.</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a href="/2018/10/11/iosApprentice/" class="prev">PREV</a><a href="/2018/10/05/designPatternSection2/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2018 <a href="http://yoursite.com"></a> <a href="https://hexo.io/" target="_blank"> </a> <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank"> </a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>